# DriveNote iOS - 實施計劃 (更新版)

---

## MVP 階段已完成模組（2025/04/18 更新）

### 支出收據模組
- [x] ReceiptCaptureView.swift：支援收據拍照、相簿選取、預覽與儲存。
- [x] ReceiptGalleryView.swift：收據圖庫瀏覽、預覽、刪除。
- [x] ReceiptGalleryViewModel.swift：管理收據資料、圖片載入與刪除。

### 里程記錄模組
- [x] MileageFormView.swift：里程新增/編輯表單，支援起訖里程、用途、抵稅等欄位。
- [x] MileageListView.swift：里程記錄列表，支援新增、刪除、點擊編輯。
- [x] MileageViewModel.swift：管理里程資料、表單驗證、CRUD 操作。
- [x] MileageView.swift：已嵌入 MileageListView，里程記錄功能可正常顯示。

### 架構與規範
- [x] 命名皆依據協議文檔，分層明確，UI 與狀態管理分離。
- [x] 各模組皆以 SwiftUI + MVVM 結構實作。

---

## 下一步建議
- 串接資料層（Repository）與 Core Data，確保資料可持久化。
- 實作工時記錄表單與列表（WorkHours）。
- 實作收入記錄模組（Income）UI 與 ViewModel。
- 優化表單驗證、深色模式、本地化。
- 準備上架相關資源。

---

## 第一階段 (2週): 準備與基礎架構

### 週1: 環境與架構準備
- **Day 1-2:** 環境設置與專案初始化
  - 安裝並配置 Xcode 14.3 (確保與 2017 MacBook Pro 兼容)
  - 建立 Git 儲存庫 (使用 GitHub 或 Bitbucket)
  - 設置分支策略 (main, develop, feature/*, hotfix/*)
  - 建立項目看板 (GitHub Projects 或 Trello)
  - 創建項目文檔結構 (README, CONTRIBUTING, CHANGELOG)

- **Day 3-4:** 雲服務設置
  - 創建 Firebase 項目 (設置開發環境與生產環境分離)
  - 配置 Firebase Authentication (匿名認證)
  - 設計並設置 Firestore 數據庫架構 (建立集合與子集合)
  - 配置 Firebase Storage (建立存儲桶與安全規則)
  - 申請 Gemini API 訪問權限 (取得 API 密鑰)
  - 使用 Postman 測試 Gemini API 呼叫與回應格式

- **Day 5:** 項目骨架與架構設計
  - 創建符合 Clean Architecture 的 SwiftUI 專案
  - 實現 MVVM 架構的基本目錄結構
  - 設計領域模型與 Use Cases
  - 設置依賴注入系統 (自定義 DI 容器)
  - 創建樣式指南與 UI 組件庫規範

### 週2: 數據層與基礎設施建立
- **Day 1-2:** Core Data 模型設計與實現
  - 設計 Core Data 實體關係圖
  - 實現所有實體模型與關係 (Expense, Receipt, Mileage, WorkHours, Income)
  - 創建 Core Data 堆棧與上下文管理
  - 設置 Core Data 模型版本遷移策略
  - 實現數據模型與領域模型之間的映射器

- **Day 3-4:** Repository 層與數據源實現
  - 設計 Repository 接口與契約
  - 實現 Core Data 本地數據源
  - 實現 Firebase 遠端數據源模板
  - 編寫數據同步和衝突解決策略
  - 建立 Repository 工廠與依賴注入

- **Day 5:** 數據層測試與性能優化
  - 編寫 Repository 層單元測試
  - 創建測試數據生成器
  - 進行數據層性能測試與分析
  - 優化查詢性能與數據存取模式
  - 實現數據預加載策略

## 第二階段 (5週): 核心功能開發

### 週3: 支出記錄功能與用戶界面基礎
- **Day 1-2:** 基礎 UI 組件開發
  - 設計並實現設計系統 (色彩、排版、間距)
  - 創建自定義 UI 組件 (卡片、表單控件、按鈕)
  - 實現深色模式支持
  - 建立 UI 組件預覽與測試

- **Day 3-5:** 支出功能實現
  - 開發支出列表頁面 (分組、過濾、排序)
  - 實現多步驟支出表單 (基本信息、詳細資料、稅務信息)
  - 創建支出類別選擇器與自定義表單邏輯
  - 實現表單驗證與錯誤處理
  - 支出數據持久化與狀態管理

### 週4: 里程與工時記錄功能
- **Day 1-3:** 里程記錄功能
  - 實現里程表單 UI (多種輸入模式)
  - 創建里程列表與詳情視圖
  - 添加里程計算邏輯 (總里程、燃料效率)
  - 實現與燃料支出關聯功能
  - 編寫里程數據持久化邏輯

- **Day 4-5:** 工時記錄功能
  - 開發工時表單 UI 與日期時間選擇器
  - 實現工時計時器功能 (開始/暫停/繼續/結束)
  - 創建工時列表與週/月視圖
  - 添加工時匯總與薪資計算
  - 實現後台計時功能

### 週5: 收入記錄與數據聯動
- **Day 1-2:** 收入記錄功能
  - 開發收入表單 UI (基本收入/小費分離)
  - 實現收入來源分類
  - 創建收入列表與圖表視圖
  - 添加收入排序與過濾功能
  - 實現收入數據持久化

- **Day 3-5:** 數據聯動與計算
  - 實現收入與工時的關聯 (時薪計算)
  - 添加里程與燃料的關聯 (效率計算)
  - 創建支出類別統計與分析
  - 實現稅務相關計算 (可抵稅總額)
  - 編寫數據一致性驗證邏輯

### 週6: 儀表板與報表功能
- **Day 1-3:** 儀表板開發
  - 設計並實現儀表板佈局
  - 創建主要指標卡片 (時薪、里程成本)
  - 實現收支摘要卡片與趨勢分析
  - 添加時間範圍選擇器 (日/週/月/年)
  - 開發儀表板數據刷新機制

- **Day 4-5:** 基礎報表功能
  - 實現報表生成邏輯
  - 創建稅務摘要報表
  - 添加支出分類報表
  - 實現報表分享功能 (PDF/CSV)
  - 開發報表視覺化組件

### 週7: UI 整合與用戶體驗優化
- **Day 1-2:** 導航與流程優化
  - 實現自定義 Tab Bar 設計
  - 優化頁面之間的導航流程
  - 添加無縫轉場動畫
  - 實現內容導航與深層鏈接
  - 添加手勢控制 (滑動返回等)

- **Day 3-4:** 用戶體驗增強
  - 添加引導提示與說明
  - 實現全應用輸入驗證
  - 添加操作反饋與確認對話框
  - 實現錯誤處理與恢復機制
  - 添加進度指示器與加載狀態

- **Day 5:** UI 測試與優化
  - 進行用戶測試與收集反饋
  - 對反饋進行分析與優先排序
  - 實施關鍵用戶體驗改進
  - 優化 UI 性能與響應速度
  - 檢查所有 UI 元素的一致性與協調性

## 第三階段 (2週): 高級功能開發

### 週8: 收據管理與 OCR 功能
- **Day 1-2:** 收據管理基礎
  - 實現收據圖庫與組織功能
  - 添加相機整合與圖片捕獲
  - 實現圖片處理與優化 (裁剪、旋轉、濾鏡)
  - 創建收據與支出關聯邏輯
  - 添加收據瀏覽與查詢功能

- **Day 3-5:** Gemini OCR 整合
  - 設計並實現 Firebase Functions 後端
  - 創建 OCR 請求格式化與處理
  - 實現 OCR 結果解析與結構化
  - 添加數據提取與表單自動填充
  - 實現 OCR 結果驗證與編輯介面

### 週9: 稅務功能與離線數據管理
- **Day 1-2:** 稅務相關功能
  - 實現英國稅務規則引擎
  - 添加可抵稅項目識別與標記
  - 實現稅務減免比例計算
  - 創建年度稅務摘要報告
  - 添加稅務相關提示與指導

- **Day 3-5:** 離線數據管理與同步
  - 實現離線優先策略
  - 創建數據變更追蹤機制
  - 添加後台同步功能
  - 實現衝突檢測與解決流程
  - 添加同步狀態與進度指示

## 第四階段 (2週): 最終整合與發布準備

### 週10: Firebase 整合與雲功能
- **Day 1-2:** Firebase 身份驗證
  - 實現匿名用戶認證
  - 添加設備識別與關聯
  - 實現可選的 Sign in with Apple
  - 創建用戶設置與首選項同步
  - 添加多設備數據訪問控制

- **Day 3-5:** 雲數據同步與備份
  - 完善 Firestore 數據同步
  - 實現增量備份與恢復
  - 添加雲存儲收據管理
  - 實現定期自動備份功能
  - 創建數據匯出與遷移工具

### 週11: 最終測試與優化
- **Day 1-2:** 性能優化
  - 進行內存使用分析與優化
  - 優化 UI 渲染性能
  - 減少網絡請求與優化緩存
  - 優化應用啟動時間
  - 減少電池消耗與後台活動

- **Day 3-5:** 全面測試與修復
  - 執行端到端功能測試
  - 進行邊緣情況測試
  - 執行可用性測試與體驗評估
  - 修復所有已知問題與異常
  - 進行最終性能評估與調整

### 週12: 發布準備與上線
- **Day 1-2:** 文檔與支持資料
  - 編寫用戶指南與常見問題
  - 創建應用內幫助系統
  - 準備隱私政策與使用條款
  - 編寫發布說明與更新日誌
  - 準備營銷材料與宣傳內容

- **Day 3-5:** App Store 提交與發布
  - 準備 App Store 元數據
  - 創建應用截圖與預覽視頻
  - 配置應用內購買與訂閱
  - 設置 App Store Connect 與測試賬戶
  - 提交審核並處理反饋

## MVP 功能優先級 (更新版)

### 階段 1: 核心 MVP (必須實現)
1. **基礎功能**
   - 支出記錄與分類 (燃料、保險、維修等)
   - 里程記錄 (起點/終點里程或總距離)
   - 工時記錄 (手動輸入與計時器功能)
   - 本地數據存儲 (Core Data)

2. **關鍵計算**
   - 時薪計算 (基於工時和收入)
   - 每英里成本計算 (基於里程和燃料支出)
   - 基本收支平衡分析

3. **基礎 UI**
   - 時尚現代設計的主界面
   - 簡化的數據輸入表單
   - 基本儀表板視圖
   - 深色模式支持

### 階段 2: MVP+ (第一次更新)
1. **增強功能**
   - 收入記錄與小費分離
   - 收據圖片拍攝與存儲
   - 基礎稅務標記 (可抵稅/不可抵稅)
   - 簡易報表生成 (PDF/CSV)

2. **用戶體驗提升**
   - 改進的資料視覺化
   - 多步驟引導式表單
   - 批量操作功能
   - 改進的過濾與搜索

### 階段 3: MVP++ (第二次更新)
1. **高級功能**
   - Gemini OCR 收據分析
   - Firebase 備份與同步
   - 稅務優化建議
   - 高級數據分析與預測

2. **營收功能**
   - 基本/高級功能訂閱模式
   - 可選的稅務顧問服務整合
   - 自定義報表模板

## 技術風險管理 (更新版)

### 硬件與開發環境限制
- **風險**: 2017 MacBook Pro 運行 Xcode 14.3 性能不足
- **嚴重程度**: 高
- **緩解措施**:
  - 使用外部 SSD 進行開發 (至少 500GB, USB 3.0 或更快)
  - 升級 RAM 至最大支持容量 (如可能)
  - 關閉 Xcode 中的實時預覽功能
  - 使用單一模擬器實例進行測試
  - 定期清理衍生數據與緩存
  - 分段開發與測試，避免同時開啟多個項目

### SwiftUI 與 iOS 15 兼容性
- **風險**: SwiftUI 的某些新特性在舊版 iOS 上不可用
- **嚴重程度**: 中
- **緩解措施**:
  - 明確設定最低支持版本為 iOS 15
  - 使用可用性檢查處理版本特定功能
  - 為不支持的功能提供優雅降級方案
  - 建立全面的設備測試矩陣

### Gemini API 整合與效能
- **風險**: OCR 準確度不足或響應時間過長
- **嚴重程度**: 中
- **緩解措施**:
  - 設計精確的提示工程 (prompt engineering)
  - 實現圖像預處理優化
  - 添加用戶手動確認與編輯功能
  - 設置請求超時與重試機制
  - 實施增量 OCR 開發 (先完成基本功能，再提高精度)

### 資料安全與隱私
- **風險**: 財務數據的安全性與隱私合規
- **嚴重程度**: 高
- **緩解措施**:
  - 設計端到端數據加密方案
  - 實現強壯的認證與授權機制
  - 支持生物識別解鎖 (Touch ID/Face ID)
  - 遵守 GDPR 與當地隱私法規
  - 創建明確的隱私政策與數據使用說明

## 開發里程碑與驗收標準

### 里程碑 1: 架構與數據層 (週2結束)
- **驗收標準**:
  - 所有 Core Data 實體模型已定義
  - 本地 CRUD 操作已實現
  - 數據層單元測試覆蓋率 > 80%
  - 架構遵循 Clean Architecture 原則

### 里程碑 2: 核心功能集 (週7結束)
- **驗收標準**:
  - 所有核心 UI 頁面已實現
  - 支出、里程、工時記錄功能完整可用
  - 主要指標計算準確 (時薪、里程成本)
  - UI 遵循設計指南與支持深色模式

### 里程碑 3: 增強功能集 (週9結束)
- **驗收標準**:
  - 收據管理與圖片處理功能可用
  - OCR 整合完成，準確率 > 85%
  - 稅務相關功能已實現並經過驗證
  - 離線數據管理機制已測試

### 里程碑 4: 發布就緒 (週12結束)
- **驗收標準**:
  - 所有關鍵 bug 已修復
  - 性能指標達標 (啟動時間 < 2秒)
  - 用戶文檔與支持資料已準備就緒
  - App Store 提交資料已完成
  - TestFlight 測試已完成

## 資源分配 (更新版)

### 時間分配
- 架構設計與數據層: 20%
- UI 開發與用戶體驗: 35%
- 業務邏輯與計算: 25%
- 雲服務集成: 10%
- 測試與優化: 10%

### 開發重點
- 優先確保核心功能可靠性
- 強調時尚現代的 UI 設計
- 追求流暢的用戶體驗
- 注重數據準確性與一致性
- 盡可能減少對後端的依賴